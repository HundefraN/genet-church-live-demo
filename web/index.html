<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details, see:
    https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="Genet Church Portal for database management.">
  <meta name="theme-color" content="#0d1117">
  <meta name="color-scheme" content="dark light">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Genet Church Portal">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>Genet Church Portal</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body { background-color: #0d1117; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }
    #loading-container { display: flex; flex-direction: column; align-items: center; justify-content: center; animation: fade-in 1.5s ease-in-out; transition: opacity 0.5s ease-out; }
    .logo-glass-container { width: 140px; height: 140px; background: rgba(22, 27, 34, 0.6); border-radius: 28px; border: 1px solid rgba(48, 54, 61, 0.8); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; animation: pulse 2.5s infinite ease-in-out; }
    #loading-logo { width: 80px; height: 80px; }
    #loading-text { color: #c9d1d9; margin-top: 24px; font-size: 18px; font-weight: 300; letter-spacing: 1.5px; min-height: 27px; }
    .loader-bars { display: flex; justify-content: center; align-items: center; height: 60px; margin-top: 10px; }
    .loader-bars div { width: 6px; height: 10px; background-color: #4FADE3; margin: 0 3px; border-radius: 3px; animation: wave 1.2s infinite ease-in-out; }
    .loader-bars div:nth-child(2) { animation-delay: 0.1s; }
    .loader-bars div:nth-child(3) { animation-delay: 0.2s; }
    .loader-bars div:nth-child(4) { animation-delay: 0.3s; }
    .loader-bars div:nth-child(5) { animation-delay: 0.4s; }
    @keyframes wave { 0%, 40%, 100% { transform: scaleY(0.4); } 20% { transform: scaleY(1.0); } }
    @keyframes pulse { 0% { transform: scale(0.98); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); } 50% { transform: scale(1); box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.4); } 100% { transform: scale(0.98); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); } }
    @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body>
<div id="loading-container">
  <div class="logo-glass-container">
    <img id="loading-logo" src="icons/logo_loader.png" alt="Loading Logo" />
  </div>
  <p id="loading-text">Initializing Portal...</p>
  <div class="loader-bars">
    <div></div><div></div><div></div><div></div><div></div>
  </div>
</div>

<script>
  var serviceWorkerVersion = null;
  var scriptLoaded = false;
  function loadMainDartJs() {
      if (scriptLoaded) {
          return;
      }
      scriptLoaded = true;
      var script = document.createElement('script');
      script.src = 'main.dart.js';
      script.type = 'application/javascript';
      document.body.appendChild(script);
  }

  if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
          navigator.serviceWorker.register('flutter_service_worker.js?v=' + serviceWorkerVersion)
              .then((reg) => {
                  function waitForActivation(serviceWorker) {
                      serviceWorker.addEventListener('statechange', () => {
                          if (serviceWorker.state == 'activated') {
                              console.log('Installed new service worker.');
                              loadMainDartJs();
                          }
                      });
                  }
                  if (!reg.active && (reg.installing || reg.waiting)) {
                      waitForActivation(reg.installing || reg.waiting);
                  } else if (!reg.active.scriptURL.endsWith(serviceWorkerVersion)) {
                      console.log('New service worker available.');
                      reg.update();
                      waitForActivation(reg.installing);
                  } else {
                      console.log('Service worker active.');
                      loadMainDartJs();
                  }
              });

          setTimeout(function() {
              if (!scriptLoaded) {
                  console.warn(
                      'Failed to load app from service worker. Falling back to plain <script> tag.',
                  );
                  loadMainDartJs();
              }
          }, 500);
      });
  } else {
      loadMainDartJs();
  }
</script>
<script src="flutter_bootstrap.js" async></script>
</body>
</html>